n <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>
      <%= title %> - <%= settings && settings.site_name ? settings.site_name :
      'ArchivArt' %> Admin
    </title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <style>
      .sidebar-transition {
        transition: all 0.3s ease-in-out;
      }
      .sidebar-hidden {
        transform: translateX(-100%);
      }
      .sidebar-collapsed {
        width: 64px !important; /* Collapsed width */
      }
      .sidebar-collapsed .nav-link span {
        display: none !important;
      }
      .sidebar-collapsed .nav-link {
        justify-content: center !important;
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
      }
      .sidebar-collapsed .nav-link i {
        margin-right: 0 !important;
      }
      .sidebar-collapsed h1 {
        display: none !important;
      }
      .sidebar-collapsed .sidebar-logo-icon {
        display: block !important;
      }
      .sidebar-collapsed .flex.items-center.justify-center {
        justify-content: center !important;
      }
      .sidebar-collapsed .sidebar-text {
        display: none !important;
      }
      .sidebar-collapsed .ml-3 {
        margin-left: 0 !important;
      }
      .sidebar-logo img {
        object-fit: contain;
        border-radius: 4px;
      }
      .main-content-expanded {
        margin-left: 0;
      }
      .main-content-collapsed {
        margin-left: 64px !important; /* Adjust for collapsed sidebar */
      }
      #navbar.navbar-collapsed {
        left: 64px !important; /* Adjust navbar for collapsed sidebar */
        right: 0 !important; /* Ensure navbar extends to full width */
        width: calc(
          100% - 64px
        ) !important; /* Full width minus collapsed sidebar */
        transition: left 0.3s ease-in-out, width 0.3s ease-in-out !important;
      }
      .navbar-mobile {
        left: 0 !important;
      }
      .navbar-mobile-expanded {
        left: 0 !important;
      }
      #navbar {
        position: fixed !important;
        top: 0 !important;
        left: 256px !important; /* 64 * 4 = 256px (w-64) */
        right: 0 !important;
        width: calc(100% - 256px) !important; /* Full width minus sidebar */
        z-index: 40 !important; /* Lower than sidebar z-index */
        transform: none !important;
        transition: left 0.3s ease-in-out, width 0.3s ease-in-out !important;
        height: 80px !important; /* Match the h-20 class */
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px) !important;
        border-bottom: 1px solid rgba(229, 231, 235, 0.5) !important;
        border-left: 1px solid rgba(229, 231, 235, 0.3) !important;
        margin-left: 0 !important;
        padding-left: 0 !important;
      }
      .navbar-mobile {
        left: 0 !important;
      }
      .navbar-mobile-expanded {
        left: 0 !important;
      }
      @media (max-width: 1024px) {
        #navbar {
          left: 0 !important;
        }
      }

      @media (max-width: 768px) {
        #main-content {
          padding: 1rem;
          padding-top: 6rem;
        }
        #navbar {
          padding: 0 1rem;
        }
        .navbar-user-info {
          display: none;
        }
      }

      @media (max-width: 640px) {
        #main-content {
          padding: 0.5rem;
          padding-top: 5rem;
        }
        #navbar {
          padding: 0 0.5rem;
        }
        .navbar-title {
          font-size: 1.125rem;
        }
      }

      /* Ensure logo container has proper padding and background */
      .sidebar-header {
        padding: 8px 20px;
        background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        border-bottom: 2px solid #374151;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <!-- Sidebar -->
    <div
      id="sidebar"
      class="fixed inset-y-0 left-0 z-50 w-64 bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 sidebar-transition shadow-2xl"
    >
      <!-- Sidebar Header -->
      <div
        class="flex items-center justify-center h-20 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 relative overflow-hidden"
      >
        <div class="absolute inset-0 bg-black opacity-20"></div>
        <div class="relative z-10">
          <!-- Show site name from settings -->
          <h1 class="text-white text-xl font-bold flex items-center">
            <div
              class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3"
            >
              <i class="fas fa-magic text-white text-sm"></i>
            </div>
            <span class="sidebar-text"
              ><%= settings && settings.site_name ? settings.site_name :
              'ArchivArt' %></span
            >
          </h1>
          <!-- Site name icon for collapsed mode -->
          <div class="sidebar-logo-icon hidden">
            <div
              class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center"
            >
              <i class="fas fa-magic text-white text-lg"></i>
            </div>
          </div>
        </div>
        <!-- Decorative elements -->
        <div
          class="absolute top-0 right-0 w-16 h-16 bg-white opacity-5 rounded-full -translate-y-8 translate-x-8"
        ></div>
        <div
          class="absolute bottom-0 left-0 w-12 h-12 bg-white opacity-5 rounded-full translate-y-6 -translate-x-6"
        ></div>
      </div>

      <!-- Sidebar Navigation -->
      <nav class="mt-8 px-4">
        <div class="space-y-2">
          <a
            href="/admin/dashboard"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-blue-500 hover:to-blue-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-tachometer-alt text-sm"></i>
            </div>
            <span>Dashboard</span>
          </a>

          <a
            href="/admin/users"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-emerald-500 hover:to-emerald-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-users text-sm"></i>
            </div>
            <span>Users</span>
          </a>

          <a
            href="/admin/media"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-purple-500 hover:to-purple-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-images text-sm"></i>
            </div>
            <span>Media</span>
          </a>

          <a
            href="/admin/media/upload"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-orange-500 hover:to-orange-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-upload text-sm"></i>
            </div>
            <span>Upload Media</span>
          </a>

          <a
            href="/admin/rbac"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-yellow-500 hover:to-yellow-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-shield-alt text-sm"></i>
            </div>
            <span>RBAC</span>
          </a>

          <a
            href="/admin/rbac/modules"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-indigo-500 hover:to-indigo-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-cubes text-sm"></i>
            </div>
            <span>Module Management</span>
          </a>

          <a
            href="/admin/settings"
            class="nav-link group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-slate-300 hover:bg-gradient-to-r hover:from-pink-500 hover:to-pink-600 hover:text-white hover:shadow-lg transition-all duration-300 hover:scale-105"
          >
            <div
              class="w-8 h-8 bg-slate-700 group-hover:bg-white group-hover:bg-opacity-20 rounded-lg flex items-center justify-center mr-3 transition-all duration-300"
            >
              <i class="fas fa-cog text-sm"></i>
            </div>
            <span>Settings</span>
          </a>
        </div>
      </nav>

      <!-- Sidebar Footer -->
      <div class="absolute bottom-0 w-full p-4">
        <div
          class="bg-gradient-to-r from-slate-800 to-slate-700 rounded-2xl p-4 border border-slate-600"
        >
          <div class="flex items-center">
            <div class="relative">
              <img
                class="h-12 w-12 rounded-xl ring-2 ring-slate-600"
                src="https://ui-avatars.com/api/?name=<%= user ? user.name : 'Admin' %>&background=random&size=48"
                alt="Admin"
              />
              <div
                class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-slate-800 rounded-full"
              ></div>
            </div>
            <div class="ml-3 sidebar-text">
              <p class="text-sm font-semibold text-white">
                <%= user ? user.name : 'Admin' %>
              </p>
              <p class="text-xs text-slate-400 capitalize">
                <%= user ? user.role : 'admin' %>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Fixed Top Navigation -->
    <nav
      id="navbar"
      class="bg-white/80 backdrop-blur-lg shadow-lg border-b border-gray-200/50"
    >
      <div class="navbar-content px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 sm:h-20">
          <div class="flex items-center min-w-0 flex-1">
            <button
              id="sidebar-toggle"
              class="text-gray-600 hover:text-gray-800 focus:outline-none focus:text-gray-800 lg:hidden p-2 rounded-xl hover:bg-gray-100 transition-all duration-200 mr-2"
            >
              <i class="fas fa-bars text-lg sm:text-xl"></i>
            </button>
            <button
              id="desktop-sidebar-toggle"
              class="text-gray-600 hover:text-gray-800 focus:outline-none focus:text-gray-800 hidden lg:block p-2 rounded-xl hover:bg-gray-100 transition-all duration-200 mr-2"
            >
              <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="min-w-0 flex-1">
              <h2
                class="navbar-title text-lg sm:text-xl lg:text-2xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent truncate"
                title="<%= title %>"
              >
                <%= title %>
              </h2>
              <p class="text-xs sm:text-sm text-gray-500 mt-1 hidden sm:block">
                Welcome to your admin panel
              </p>
            </div>
          </div>

          <div class="flex items-center space-x-2 sm:space-x-4 lg:space-x-6">
            <!-- Search -->
            <!-- <div class="hidden md:block">
                        <div class="relative">
                            <input type="text" placeholder="Search..." class="w-64 pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div> -->

            <!-- Notifications -->
            <!-- <button class="relative p-3 text-gray-600 hover:text-gray-800 focus:outline-none rounded-xl hover:bg-gray-100 transition-all duration-200 group">
                        <i class="fas fa-bell text-xl group-hover:scale-110 transition-transform"></i>
                        <span class="absolute -top-1 -right-1 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-semibold shadow-lg">3</span>
                    </button> -->

            <!-- User Menu -->
            <div class="relative">
              <button
                id="user-menu-button"
                class="flex items-center space-x-2 sm:space-x-3 p-1 sm:p-2 rounded-xl hover:bg-gray-100 transition-all duration-200 group"
              >
                <div class="relative">
                  <img
                    class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl ring-2 ring-gray-200 group-hover:ring-indigo-300 transition-all duration-200"
                    src="https://ui-avatars.com/api/?name=<%= user ? user.name : 'Admin' %>&background=random&size=40"
                    alt="Admin"
                  />
                  <div
                    class="absolute -bottom-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-green-400 border-2 border-white rounded-full"
                  ></div>
                </div>
                <div class="navbar-user-info hidden md:block text-left">
                  <p class="text-sm font-semibold text-gray-900">
                    <%= user ? user.name : 'Admin' %>
                  </p>
                  <p class="text-xs text-gray-500 capitalize">
                    <%= user ? user.role : 'admin' %>
                  </p>
                </div>
                <i
                  class="fas fa-chevron-down text-gray-400 group-hover:text-gray-600 transition-colors text-sm sm:text-base"
                ></i>
              </button>

              <!-- Dropdown Menu -->
              <div
                id="user-menu"
                class="hidden absolute right-0 mt-3 w-56 bg-white rounded-2xl shadow-xl border border-gray-200 py-2 z-50"
              >
                <div class="px-4 py-3 border-b border-gray-100">
                  <p class="text-sm font-semibold text-gray-900">
                    <%= user ? user.name : 'Admin' %>
                  </p>
                  <p class="text-xs text-gray-500">
                    <%= user ? user.email : 'admin@archivart.com' %>
                  </p>
                </div>
                <a
                  href="/admin/profile"
                  class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-blue-600 transition-all duration-200"
                >
                  <div
                    class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-user text-blue-600 text-sm"></i>
                  </div>
                  Profile
                </a>
                <a
                  href="/admin/settings"
                  class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 hover:text-purple-600 transition-all duration-200"
                >
                  <div
                    class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-cog text-purple-600 text-sm"></i>
                  </div>
                  Settings
                </a>
                <hr class="my-2 border-gray-100" />
                <a
                  href="/admin/logout"
                  class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-red-50 hover:to-pink-50 hover:text-red-600 transition-all duration-200"
                >
                  <div
                    class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-sign-out-alt text-red-600 text-sm"></i>
                  </div>
                  Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div id="main-content" class="ml-64 sidebar-transition">
      <!-- Page Content -->
      <main
        class="pt-24 p-8 bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 min-h-screen"
      >
        <!-- Flash Messages (Hidden - converted to toasters) -->
        <% if (success_msg && success_msg.length > 0) { %>
        <div class="hidden" id="success-flash-message"><%= success_msg %></div>
        <% } %> <% if (error_msg && error_msg.length > 0) { %>
        <div
          class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"
        >
          <i class="fas fa-exclamation-circle mr-2"></i>
          <%= error_msg %>
        </div>
        <% } %>

        <!-- Page Content -->
        <%- body %>
      </main>
    </div>

    <!-- JavaScript -->
    <script>
      // Sidebar toggle for mobile
      document
        .getElementById("sidebar-toggle")
        .addEventListener("click", function () {
          const sidebar = document.getElementById("sidebar");
          const mainContent = document.getElementById("main-content");
          const navbar = document.getElementById("navbar");

          sidebar.classList.toggle("sidebar-hidden");
          mainContent.classList.toggle("main-content-expanded");
          navbar.classList.toggle("navbar-mobile-expanded");
        });

      // Desktop sidebar toggle (collapse/expand)
      document
        .getElementById("desktop-sidebar-toggle")
        .addEventListener("click", function () {
          const sidebar = document.getElementById("sidebar");
          const mainContent = document.getElementById("main-content");
          const navbar = document.getElementById("navbar");

          sidebar.classList.toggle("sidebar-collapsed");
          mainContent.classList.toggle("main-content-collapsed");
          navbar.classList.toggle("navbar-collapsed");

          // Debug: Log the current state
          console.log(
            "Sidebar collapsed:",
            sidebar.classList.contains("sidebar-collapsed")
          );
          console.log(
            "Navbar collapsed:",
            navbar.classList.contains("navbar-collapsed")
          );
          console.log("Navbar classes:", navbar.className);
        });

      // User menu toggle
      document
        .getElementById("user-menu-button")
        .addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();

          const userMenu = document.getElementById("user-menu");
          const isHidden = userMenu.classList.contains("hidden");

          if (isHidden) {
            userMenu.classList.remove("hidden");
            userMenu.style.display = "block";
          } else {
            userMenu.classList.add("hidden");
            userMenu.style.display = "none";
          }
        });

      // Close user menu when clicking outside
      document.addEventListener("click", function (event) {
        const userMenu = document.getElementById("user-menu");
        const userMenuButton = document.getElementById("user-menu-button");

        if (
          !userMenuButton.contains(event.target) &&
          !userMenu.contains(event.target)
        ) {
          userMenu.classList.add("hidden");
          userMenu.style.display = "none";
        }
      });

      // Close user menu when clicking on menu items
      const userMenuItems = document.querySelectorAll("#user-menu a");
      userMenuItems.forEach((item) => {
        item.addEventListener("click", function () {
          const userMenu = document.getElementById("user-menu");
          userMenu.classList.add("hidden");
          userMenu.style.display = "none";
        });
      });

      // Active navigation link
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll(".nav-link");

      navLinks.forEach((link) => {
        const linkHref = link.getAttribute("href");

        // Special case: Don't highlight Media tab when on upload media page
        if (
          linkHref === "/admin/media" &&
          currentPath === "/admin/media/upload"
        ) {
          return; // Skip highlighting for this case
        }

        // Check for exact match or if current path starts with the link href
        // This handles sub-paths like /admin/media/edit/1 matching /admin/media
        if (
          linkHref === currentPath ||
          currentPath.startsWith(linkHref + "/")
        ) {
          link.classList.remove(
            "text-slate-300",
            "hover:bg-gradient-to-r",
            "hover:from-blue-500",
            "hover:to-blue-600",
            "hover:from-emerald-500",
            "hover:to-emerald-600",
            "hover:from-purple-500",
            "hover:to-purple-600",
            "hover:from-orange-500",
            "hover:to-orange-600",
            "hover:from-pink-500",
            "hover:to-pink-600",
            "hover:text-white",
            "hover:shadow-lg",
            "hover:scale-105"
          );
          link.classList.add(
            "bg-gradient-to-r",
            "from-indigo-500",
            "to-purple-600",
            "text-white",
            "shadow-lg",
            "scale-105"
          );
        }
      });

      // Handle flash messages with toaster notifications
      document.addEventListener("DOMContentLoaded", function () {
        // Handle hidden success messages (converted to toasters)
        const successFlashMessage = document.getElementById(
          "success-flash-message"
        );
        if (successFlashMessage) {
          const messageText = successFlashMessage.textContent.trim();
          if (messageText && typeof showSuccessToast === "function") {
            showSuccessToast(messageText);
            successFlashMessage.remove();
          }
        }

        // Handle visible error messages (convert to toasters and hide)
        const errorMessages = document.querySelectorAll(
          ".bg-red-100.border-red-400"
        );
        errorMessages.forEach(function (message) {
          const messageText = message.textContent.trim();
          if (messageText) {
            showErrorToast(messageText);
            message.remove();
          }
        });
      });
    </script>

    <!-- Include Toaster System -->
    <%- include('../partials/toaster') %>

    <!-- Include Modal System -->
    <%- include('../partials/modal') %>

    <!-- Include Global Loader -->
    <%- include('../partials/global-loader') %>

    <!-- ============================================ -->
    <!-- CORE DEPENDENCIES (Always Load First) -->
    <!-- ============================================ -->

    <!-- Global Loader JavaScript -->
    <script src="/js/global-loader.js"></script>

    <!-- Table JavaScript - Core dependency for management pages -->
    <% if (typeof title !== 'undefined') { %>
    <script src="/js/table.js"></script>
    <% } %>

    <!-- ============================================ -->
    <!-- MANAGEMENT SCRIPTS (Load After Dependencies) -->
    <!-- ============================================ -->

    <!-- Users Management javascript - only loaded on users management page -->
    <% if (typeof title !== 'undefined' && title.includes('User')) { %>
        <script src="/js/users-management.js"></script>
    <% } %>

    <!-- Users management script is loaded externally -->

    <!-- Media Management javascript - only loaded on media management page -->
    <% if (typeof title !== 'undefined' && title.includes('Media') &&
    !title.includes('Upload Media') && !title.includes('Edit Media')) { %>
    <script src="/js/media-management.js"></script>
    <% } %>

    <!-- RBAC Dashboard javascript - only loaded on RBAC dashboard page -->
    <% if (typeof title !== 'undefined' && title.includes('RBAC Management')) {
    %>
    <script src="/js/rbac-dashboard.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- RBAC Roles javascript - only loaded on roles management page -->
    <% if (typeof title !== 'undefined' && title.includes('Roles Management')) {
    %>
    <script src="/js/rbac-roles.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- RBAC Permissions javascript - only loaded on permissions management page -->
    <% if (typeof title !== 'undefined' && title.includes('Permissions Management')) { %>
    <script src="/js/rbac-permissions.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- RBAC Role Permissions javascript - only loaded on role permissions page -->
    <% if (typeof title !== 'undefined' && title.includes('Role Permissions')) {
    %>
    <script src="/js/rbac-role-permissions.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- RBAC Modules javascript - only loaded on module management page -->
    <% if (typeof title !== 'undefined' && title.includes('Module Management'))
    { %>
    <script src="/js/rbac-modules.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- RBAC Module Actions javascript - only loaded on module actions page -->
    <% if (typeof title !== 'undefined' && title.includes('Module Actions')) {
    %>
    <script src="/js/rbac-module-actions.js?v=<%= Date.now() %>"></script>
    <% } %>

    <!-- Media upload javascript - only loaded on media upload pages -->
    <% if (typeof title !== 'undefined' && title.includes('Upload Media')) { %>
    <script src="/js/media-upload.js"></script>
    <% } %>

    <!-- Media edit javascript - only loaded on media edit pages -->
    <% if (typeof title !== 'undefined' && title.includes('Edit Media')) { %>
    <script src="/js/media-edit.js"></script>
    <% } %>

    <!-- Settings javascript - only loaded on settings pages -->
    <% if (typeof title !== 'undefined' && title.includes('Settings')) { %>
    <script src="/js/settings.js"></script>
    <% } %>

    <!-- Table initialization for management pages -->
    <% if (typeof title !== 'undefined' && (title.includes('Media') ||
    title.includes('Users') || title.includes('Roles Management') ||
    title.includes('Permissions Management'))) { %>
    <script>
      // Initialize table for management pages
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for formatters to be available before initializing table
        function waitForFormatters() {
          if (typeof TableUtils !== "undefined" && TableUtils.initTable) {
            // For users page, wait for user formatters
            if (window.location.pathname.includes('/users')) {
              if (typeof window.formatStatus === 'function' && 
                  typeof window.formatRole === 'function' && 
                  typeof window.formatDate === 'function' && 
                  typeof window.formatAvatar === 'function') {
                console.log('All user formatters loaded, initializing table');
                TableUtils.initTable({
                  sort: { column: "created_at", direction: "desc" },
                  page: 1,
                  search: "",
                  filters: {},
                });
              } else {
                console.log('Waiting for user formatters...');
                setTimeout(waitForFormatters, 100);
              }
            } else {
              // For other pages, initialize immediately
              TableUtils.initTable({
                sort: { column: "created_at", direction: "desc" },
                page: 1,
                search: "",
                filters: {},
              });
            }
          } else {
            setTimeout(waitForFormatters, 100);
          }
        }
        waitForFormatters();
      });
    </script>
    <% } %>
  </body>
</html>
