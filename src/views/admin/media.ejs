<!-- Include Common Table Component -->
<%- include('../components/table', {
    title: title,
    data: media,
    headerButtons: [
        {
            text: 'Upload Media',
            href: '/admin/media/upload',
            icon: 'fas fa-plus',
            class: 'inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500'
        }
    ],
    columns: [
        { key: 'title', label: 'Title', sortable: true, wrap: true, maxWidth: 'sm', type: 'custom', formatter: (item) => `
            <div class="flex items-center">
                <div class="flex-shrink-0 h-12 w-12">
                    ${item.media_type === 'image' ? 
                        `<img class=\"h-12 w-12 rounded-lg object-cover\" src=\"${typeof mediaUrl === 'function' ? '${mediaUrl("' + item.file_path + '")}' : '/uploads/media/' + item.file_path}\" alt=\"${item.title}\">` :
                        `<div class="h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-${item.media_type === 'video' ? 'video' : 'music'} text-gray-500"></i>
                        </div>`
                    }
                </div>
                <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">${item.title}</div>
                    <div class="text-sm text-gray-500">${item.media_type}</div>
                </div>
            </div>
        ` },
        { key: 'description', label: 'Description', sortable: false, wrap: true, maxWidth: 'md' },
        { key: 'scanning_image', label: 'Scanning Image', sortable: true, wrap: false },
        { key: 'is_active', label: 'Status', sortable: true, wrap: false, type: 'badge', formatter: (item) => item.is_active ? 'Active' : 'Inactive', badgeClass: (item) => item.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' },
        { key: 'created_at', label: 'Created', sortable: true, wrap: false },
        { key: 'uploaded_by_name', label: 'Uploaded By', sortable: true, wrap: false }
    ],
    actions: [
        {
            icon: (item) => 'fas fa-eye',
            title: (item) => 'View',
            class: 'text-indigo-600 hover:text-indigo-900',
            onclick: (item) => `window.location.href='/admin/media/view/${item.id}'`
        },
        {
            icon: (item) => 'fas fa-edit',
            title: (item) => 'Edit',
            class: 'text-blue-600 hover:text-blue-900',
            onclick: (item) => `window.location.href='/admin/media/edit/${item.id}'`
        },
        {
            icon: (item) => item.is_active ? 'fas fa-pause' : 'fas fa-play',
            title: (item) => item.is_active ? 'Deactivate' : 'Activate',
            class: (item) => `text-${item.is_active ? 'yellow' : 'green'}-600 hover:text-${item.is_active ? 'yellow' : 'green'}-900`,
            onclick: (item) => `toggleMediaStatus(${item.id})`
        },
        {
            icon: (item) => 'fas fa-trash',
            title: (item) => 'Delete',
            class: 'text-red-600 hover:text-red-900',
            onclick: (item) => `deleteMedia(${item.id})`
        }
    ],
    pagination: pagination,
    search: search,
    filters: [
        {
            key: 'media_type',
            label: 'Media Type',
            options: [
                { value: '', label: 'All Types' },
                { value: 'image', label: 'Image' },
                { value: 'video', label: 'Video' },
                { value: 'audio', label: 'Audio' }
            ],
            current: filters.media_type
        },
        {
            key: 'is_active',
            label: 'Status',
            options: [
                { value: '', label: 'All Status' },
                { value: '1', label: 'Active' },
                { value: '0', label: 'Inactive' }
            ],
            current: filters.is_active
        }
    ],
    showSearch: true,
    searchPlaceholder: 'Search media by title or description...',
    emptyIcon: 'fas fa-images',
    emptyTitle: 'No Media Found',
    emptyMessage: 'No media files have been uploaded yet.',
    emptySearchMessage: 'No media files match your search criteria.'
}) %>

<!-- Media View Modal -->
<div id="viewMediaModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-40">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900">Media Details</h3>
                <button onclick="closeModal('viewMediaModal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="mediaDetails" class="space-y-4">
                <!-- Media details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Media Edit Modal removed - now using dedicated edit page -->

<!-- Upload Media Modal -->
<div id="uploadMediaModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-40">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900">Upload Media</h3>
                <button onclick="closeModal('uploadMediaModal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="uploadMediaForm" enctype="multipart/form-data" class="space-y-4">
                <div>
                    <label for="uploadTitle" class="block text-sm font-medium text-gray-700">Title *</label>
                    <input type="text" id="uploadTitle" name="title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required>
                </div>
                <div>
                    <label for="uploadDescription" class="block text-sm font-medium text-gray-700">Description</label>
                    <textarea id="uploadDescription" name="description" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="uploadMediaType" class="block text-sm font-medium text-gray-700">Media Type *</label>
                    <select id="uploadMediaType" name="media_type" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required>
                        <option value="">Select Media Type</option>
                        <option value="image">Image</option>
                        <option value="video">Video</option>
                        <option value="audio">Audio</option>
                    </select>
                </div>
                <div>
                    <label for="uploadMediaFile" class="block text-sm font-medium text-gray-700">Media File *</label>
                    <input type="file" id="uploadMediaFile" name="media_file" accept="image/*,video/*,audio/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" required>
                    <p class="mt-1 text-sm text-gray-500">Supported formats: Images (JPEG, PNG, GIF, WebP), Videos (MP4, AVI, MOV, WMV), Audio (MP3, WAV, M4A, OGG). Max size: 100MB</p>
                </div>
                <div>
                    <label for="uploadScanningImage" class="block text-sm font-medium text-gray-700">Scanning Image *</label>
                    <input type="file" id="uploadScanningImage" name="scanning_image" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" required>
                    <p class="mt-1 text-sm text-gray-500">This image will be used for AR scanning. Must be unique across all media.</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal('uploadMediaModal')" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Upload Media
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>