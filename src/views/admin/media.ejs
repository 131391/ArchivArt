<!-- Include Common Table Component -->
<%- include('../components/table', {
    title: title,
    data: media,
    headerButtons: [
        {
            text: 'Upload Media',
            href: '/admin/media/upload',
            icon: 'fas fa-cloud-upload-alt',
            class: 'inline-flex items-center px-6 py-3 border border-transparent text-sm font-semibold rounded-xl text-white bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl'
        }
    ],
    columns: [
        { key: 'title', label: 'Title', sortable: true, wrap: true, maxWidth: 'sm', type: 'custom', formatter: (item) => `
            <div class="flex items-center">
                <div class="flex-shrink-0 h-12 w-12">
                    ${item.media_type === 'image' ? 
                        `<img class=\"h-12 w-12 rounded-lg object-cover\" src=\"${typeof mediaUrl === 'function' ? '${mediaUrl("' + item.file_path + '")}' : '/uploads/media/' + item.file_path}\" alt=\"${item.title}\">` :
                        `<div class="h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-${item.media_type === 'video' ? 'video' : 'music'} text-gray-500"></i>
                        </div>`
                    }
                </div>
                <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">${item.title}</div>
                    <div class="text-sm text-gray-500">${item.media_type}</div>
                </div>
            </div>
        ` },
        { key: 'description', label: 'Description', sortable: false, wrap: true, maxWidth: 'md' },
        { key: 'scanning_image', label: 'Scanning Image', sortable: true, wrap: false, type: 'custom', formatter: (item) => `
            <div class="flex items-center">
                <div class="flex-shrink-0 h-12 w-12">
                    <img class="h-12 w-12 rounded-lg object-cover border border-gray-200" 
                         src="${typeof scanningImageUrl === 'function' ? scanningImageUrl(item.scanning_image) : '/uploads/media/' + item.scanning_image}" 
                         alt="Scanning Image" 
                         onerror="this.src='/images/placeholder-image.png'; this.alt='Image not found'">
                </div>
                <div class="ml-3">
                    <div class="text-xs text-gray-500 truncate max-w-32">
                        ${item.scanning_image ? item.scanning_image.split('/').pop() : 'No image'}
                    </div>
                </div>
            </div>
        ` },
        { key: 'media_type', label: 'Media Type', sortable: true, wrap: false, type: 'badge', formatter: (item) => {
            const typeConfig = {
                'image': { label: 'Image', class: 'bg-blue-100 text-blue-800' },
                'video': { label: 'Video', class: 'bg-purple-100 text-purple-800' },
                'audio': { label: 'Audio', class: 'bg-green-100 text-green-800' }
            };
            const config = typeConfig[item.media_type] || { label: item.media_type || 'Unknown', class: 'bg-gray-100 text-gray-800' };
            return config.label;
        }, badgeClass: (item) => {
            const typeConfig = {
                'image': 'bg-blue-100 text-blue-800',
                'video': 'bg-purple-100 text-purple-800',
                'audio': 'bg-green-100 text-green-800'
            };
            return typeConfig[item.media_type] || 'bg-gray-100 text-gray-800';
        }},
        { key: 'is_active', label: 'Status', sortable: true, wrap: false, type: 'badge', formatter: (item) => item.is_active ? 'Active' : 'Inactive', badgeClass: (item) => item.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' },
        { key: 'created_at', label: 'Created', sortable: true, wrap: false },
        { key: 'uploaded_by_name', label: 'Uploaded By', sortable: true, wrap: false }
    ],
    actions: [
        {
            icon: (item) => 'fas fa-eye',
            title: (item) => 'View',
            class: 'text-indigo-600 hover:text-indigo-900',
            onclick: (item) => `window.location.href='/admin/media/view/${item.id}'`
        },
        {
            icon: (item) => 'fas fa-edit',
            title: (item) => 'Edit',
            class: 'text-blue-600 hover:text-blue-900',
            onclick: (item) => `window.location.href='/admin/media/edit/${item.id}'`
        },
        {
            icon: (item) => item.is_active ? 'fas fa-pause' : 'fas fa-play',
            title: (item) => item.is_active ? 'Deactivate' : 'Activate',
            class: (item) => `text-${item.is_active ? 'yellow' : 'green'}-600 hover:text-${item.is_active ? 'yellow' : 'green'}-900`,
            onclick: (item) => `toggleMediaStatus(${item.id})`
        },
        {
            icon: (item) => 'fas fa-trash',
            title: (item) => 'Delete',
            class: 'text-red-600 hover:text-red-900',
            onclick: (item) => `deleteMedia(${item.id})`
        }
    ],
    pagination: pagination,
    search: search,
    filters: [
        {
            key: 'media_type',
            label: 'Media Type',
            options: [
                { value: '', label: 'All Types' },
                { value: 'image', label: 'Image' },
                { value: 'video', label: 'Video' },
                { value: 'audio', label: 'Audio' }
            ],
            current: filters.media_type
        },
        {
            key: 'is_active',
            label: 'Status',
            options: [
                { value: '', label: 'All Status' },
                { value: '1', label: 'Active' },
                { value: '0', label: 'Inactive' }
            ],
            current: filters.is_active
        }
    ],
    showSearch: true,
    searchPlaceholder: 'Search media by title or description...',
    emptyIcon: 'fas fa-images',
    emptyTitle: 'No Media Found',
    emptyMessage: 'No media files have been uploaded yet.',
    emptySearchMessage: 'No media files match your search criteria.'
}) %>

<!-- Enhanced Media View Modal -->
<div id="viewMediaModal" class="fixed inset-0 bg-black bg-opacity-60 overflow-y-auto h-full w-full hidden z-40 backdrop-blur-sm">
    <div class="relative top-20 mx-auto p-0 border-0 w-11/12 md:w-3/4 lg:w-1/2 shadow-2xl rounded-2xl bg-white transform transition-all duration-300 ease-out scale-95 opacity-0" id="viewMediaModalContainer">
        <!-- Modal Header with Gradient -->
        <div class="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-t-2xl p-6 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0 mr-4">
                        <i class="fas fa-play-circle text-white text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold">Media Details</h3>
                </div>
                <button onclick="closeModal('viewMediaModal')" class="text-white hover:text-gray-200 transition-colors duration-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Body -->
        <div class="p-6">
            <div id="mediaDetails" class="space-y-4">
                <!-- Media details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Media Edit Modal removed - now using dedicated edit page -->

<!-- Enhanced Upload Media Modal -->
<div id="uploadMediaModal" class="fixed inset-0 bg-black bg-opacity-60 overflow-y-auto h-full w-full hidden z-40 backdrop-blur-sm">
    <div class="relative top-20 mx-auto p-0 border-0 w-11/12 md:w-3/4 lg:w-1/2 shadow-2xl rounded-2xl bg-white transform transition-all duration-300 ease-out scale-95 opacity-0" id="uploadMediaModalContainer">
        <!-- Modal Header with Gradient -->
        <div class="bg-gradient-to-r from-emerald-500 to-green-600 rounded-t-2xl p-6 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0 mr-4">
                        <i class="fas fa-cloud-upload-alt text-white text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold">Upload Media</h3>
                </div>
                <button onclick="closeModal('uploadMediaModal')" class="text-white hover:text-gray-200 transition-colors duration-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Body -->
        <div class="p-6">
            <form id="uploadMediaForm" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <label for="uploadTitle" class="block text-sm font-semibold text-gray-700 mb-2">Media Title *</label>
                    <input type="text" id="uploadTitle" name="title" class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" required>
                </div>
                
                <div>
                    <label for="uploadDescription" class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
                    <textarea id="uploadDescription" name="description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"></textarea>
                </div>
                
                <div>
                    <label for="uploadMediaType" class="block text-sm font-semibold text-gray-700 mb-2">Media Type *</label>
                    <select id="uploadMediaType" name="media_type" class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" required>
                        <option value="">Select Media Type</option>
                        <option value="image">Image</option>
                        <option value="video">Video</option>
                        <option value="audio">Audio</option>
                    </select>
                </div>
                
                <div>
                    <label for="uploadMediaFile" class="block text-sm font-semibold text-gray-700 mb-2">Media File *</label>
                    <input type="file" id="uploadMediaFile" name="media_file" accept="image/*,video/*,audio/*" class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100" required>
                    <p class="mt-2 text-sm text-gray-500">Supported formats: Images (JPEG, PNG, GIF, WebP), Videos (MP4, AVI, MOV, WMV), Audio (MP3, WAV, M4A, OGG). Max size: 100MB</p>
                </div>
                
                <div>
                    <label for="uploadScanningImage" class="block text-sm font-semibold text-gray-700 mb-2">Scanning Image *</label>
                    <input type="file" id="uploadScanningImage" name="scanning_image" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100" required>
                    <p class="mt-2 text-sm text-gray-500">This image will be used for AR scanning. Must be unique across all media.</p>
                </div>
                
                <!-- Modal Actions -->
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeModal('uploadMediaModal')" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all duration-200 font-medium">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white rounded-xl hover:from-emerald-600 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-emerald-300 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="fas fa-cloud-upload-alt mr-2"></i>
                        Upload Media
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>