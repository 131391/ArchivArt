<script>
// Make formatStatus function available globally for table formatting
window.formatStatus = function(item) {
    return item.is_active ? 
        '<span class="px-2 inline-flex items-center text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"><i class="fas fa-check-circle mr-1"></i>Active</span>' : 
        '<span class="px-2 inline-flex items-center text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"><i class="fas fa-times-circle mr-1"></i>Inactive</span>';
};
</script>

<!-- Include Common Table Component -->
<%- include('../../components/table', {
    title: title,
    data: data,
    showSearch: true,
    showFilters: false,
    searchPlaceholder: 'Search actions...',
    columns: [
        { key: 'id', label: 'ID', sortable: true },
        { key: 'name', label: 'Action Name', sortable: true },
        { key: 'display_name', label: 'Display Name', sortable: true },
        { key: 'description', label: 'Description', sortable: false },
        { key: 'is_active', label: 'Status', sortable: true, type: 'custom', formatter: 'formatStatus' }
    ],
    actions: [
        { name: 'view', label: 'View', icon: 'fas fa-eye', class: 'text-blue-600 hover:text-blue-900', onclick: (item) => `viewModuleAction(${item.id})` },
        { name: 'edit', label: 'Edit', icon: 'fas fa-edit', class: 'text-indigo-600 hover:text-indigo-900', onclick: (item) => `editModuleAction(${item.id})` },
        { name: 'delete', label: 'Delete', icon: 'fas fa-trash', class: 'text-red-600 hover:text-red-900', onclick: (item) => `deleteModuleAction(${item.id})` }
    ],
    headerButtons: [
        { 
            name: 'create', 
            label: '+ Create Action', 
            class: 'bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:shadow-lg', 
            onclick: 'createModuleAction()' 
        },
        { 
            name: 'back', 
            label: '← Back to Modules', 
            class: 'bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:shadow-lg', 
            href: '/admin/rbac/modules' 
        }
    ]
}) %>

<!-- View Module Action Modal -->
<div id="viewModuleActionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="flex min-h-full items-center justify-center p-4">
        <div id="viewModuleActionModalContainer" class="relative w-full max-w-lg bg-white rounded-2xl shadow-2xl transform transition-all duration-300 scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-t-2xl px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-eye text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white">Module Action Details</h3>
                            <p class="text-green-100 text-sm">View action information and settings</p>
                        </div>
                    </div>
                    <button onclick="closeViewModuleActionModal()" class="w-8 h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg flex items-center justify-center transition-all duration-200">
                        <i class="fas fa-times text-white text-sm"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6">
                <div id="moduleActionDetails" class="space-y-6">
                    <!-- Module action details will be populated here -->
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="bg-gray-50 rounded-b-2xl px-6 py-4">
                <div class="flex justify-end space-x-3">
                    <button type="button" 
                            onclick="closeViewModuleActionModal()" 
                            class="px-6 py-2.5 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
                        <i class="fas fa-times mr-2"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Module Action Modal -->
<div id="editModuleActionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="flex min-h-full items-center justify-center p-4">
        <div id="editModuleActionModalContainer" class="relative w-full max-w-lg bg-white rounded-2xl shadow-2xl transform transition-all duration-300 scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-t-2xl px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-edit text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white">Edit Module Action</h3>
                            <p class="text-blue-100 text-sm">Update action details and settings</p>
                        </div>
                    </div>
                    <button onclick="closeEditModuleActionModal()" class="w-8 h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg flex items-center justify-center transition-all duration-200">
                        <i class="fas fa-times text-white text-sm"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form id="editModuleActionForm" class="p-6 space-y-6">
                <input type="hidden" id="editModuleActionId" name="id">
                
                <!-- Action Name -->
                <div class="space-y-2">
                    <label for="editModuleActionName" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-tag w-4 h-4 mr-2 text-gray-400"></i>
                        Action Name
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="editModuleActionName" 
                               name="name" 
                               placeholder="e.g., create_user, edit_post"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" 
                               required>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-code text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Internal identifier used in code (lowercase, underscores only)</p>
                </div>

                <!-- Display Name -->
                <div class="space-y-2">
                    <label for="editModuleActionDisplayName" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-eye w-4 h-4 mr-2 text-gray-400"></i>
                        Display Name
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="editModuleActionDisplayName" 
                               name="display_name" 
                               placeholder="e.g., Create User, Edit Post"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" 
                               required>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-font text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">User-friendly name shown in the interface</p>
                </div>

                <!-- Description -->
                <div class="space-y-2">
                    <label for="editModuleActionDescription" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-align-left w-4 h-4 mr-2 text-gray-400"></i>
                        Description
                    </label>
                    <div class="relative">
                        <textarea id="editModuleActionDescription" 
                                  name="description" 
                                  rows="4" 
                                  placeholder="Describe what this action does..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white resize-none"></textarea>
                        <div class="absolute top-3 right-3 pointer-events-none">
                            <i class="fas fa-paragraph text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Optional description to help users understand this action</p>
                </div>

                <!-- Status -->
                <div class="space-y-2">
                    <label for="editModuleActionStatus" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-toggle-on w-4 h-4 mr-2 text-gray-400"></i>
                        Status
                    </label>
                    <div class="relative">
                        <select id="editModuleActionStatus" name="is_active" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white appearance-none">
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Whether this action is available for use</p>
                </div>
            </form>
            
            <!-- Modal Footer -->
            <div class="bg-gray-50 rounded-b-2xl px-6 py-4">
                <div class="flex justify-end space-x-3">
                    <button type="button" 
                            onclick="closeEditModuleActionModal()" 
                            class="px-6 py-2.5 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </button>
                    <button type="submit" 
                            form="editModuleActionForm"
                            class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i class="fas fa-save mr-2"></i>
                        Update Action
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Module Action Modal -->
<div id="createModuleActionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="flex min-h-full items-center justify-center p-4">
        <div id="createModuleActionModalContainer" class="relative w-full max-w-lg bg-white rounded-2xl shadow-2xl transform transition-all duration-300 scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-t-2xl px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-plus text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white">Create Module Action</h3>
                            <p class="text-indigo-100 text-sm">Add a new action to this module</p>
                        </div>
                    </div>
                    <button onclick="closeCreateModuleActionModal()" class="w-8 h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg flex items-center justify-center transition-all duration-200">
                        <i class="fas fa-times text-white text-sm"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form id="createModuleActionForm" class="p-6 space-y-6">
                <!-- Action Name -->
                <div class="space-y-2">
                    <label for="createModuleActionName" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-tag w-4 h-4 mr-2 text-gray-400"></i>
                        Action Name
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="createModuleActionName" 
                               name="name" 
                               placeholder="e.g., create_user, edit_post"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" 
                               required>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-code text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Internal identifier used in code (lowercase, underscores only)</p>
                </div>

                <!-- Display Name -->
                <div class="space-y-2">
                    <label for="createModuleActionDisplayName" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-eye w-4 h-4 mr-2 text-gray-400"></i>
                        Display Name
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="createModuleActionDisplayName" 
                               name="display_name" 
                               placeholder="e.g., Create User, Edit Post"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white" 
                               required>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-font text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">User-friendly name shown in the interface</p>
                </div>

                <!-- Description -->
                <div class="space-y-2">
                    <label for="createModuleActionDescription" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-align-left w-4 h-4 mr-2 text-gray-400"></i>
                        Description
                    </label>
                    <div class="relative">
                        <textarea id="createModuleActionDescription" 
                                  name="description" 
                                  rows="4" 
                                  placeholder="Describe what this action does..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white resize-none"></textarea>
                        <div class="absolute top-3 right-3 pointer-events-none">
                            <i class="fas fa-paragraph text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Optional description to help users understand this action</p>
                </div>

                <!-- Status -->
                <div class="space-y-2">
                    <label for="createModuleActionStatus" class="flex items-center text-sm font-semibold text-gray-700">
                        <i class="fas fa-toggle-on w-4 h-4 mr-2 text-gray-400"></i>
                        Status
                    </label>
                    <div class="relative">
                        <select id="createModuleActionStatus" name="is_active" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white appearance-none">
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Whether this action is available for use</p>
                </div>
            </form>
            
            <!-- Modal Footer -->
            <div class="bg-gray-50 rounded-b-2xl px-6 py-4">
                <div class="flex justify-end space-x-3">
                    <button type="button" 
                            onclick="closeCreateModuleActionModal()" 
                            class="px-6 py-2.5 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </button>
                    <button type="submit" 
                            form="createModuleActionForm"
                            class="px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i class="fas fa-plus mr-2"></i>
                        Create Action
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
