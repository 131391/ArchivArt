<!-- Media View Page -->
<div class="flex-1 min-h-screen bg-gray-50">
    <div class="w-full px-4 sm:px-6 lg:px-8 py-6">
        <!-- Page Header -->
        <div class="mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Media Details</h1>
                    <p class="mt-1 text-sm text-gray-600">View and interact with your media content</p>
                </div>
                <div class="flex space-x-3">
                    <a href="/admin/media" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Media List
                    </a>
                    <button onclick="editMedia(<%= media.id %>)" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        <i class="fas fa-edit mr-2"></i>
                        Edit Media
                    </button>
                </div>
            </div>
        </div>

        <!-- Media Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Media Player Section -->
            <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-<%= media.media_type === 'video' ? 'video' : media.media_type === 'audio' ? 'music' : 'image' %> text-white text-sm"></i>
                        </div>
                        <%= media.media_type.charAt(0).toUpperCase() + media.media_type.slice(1) %> Content
                    </h2>
                    <p class="text-indigo-100 text-sm mt-1">Uploaded media file</p>
                </div>

                <!-- Media Player -->
                <div class="p-6">
                    <div class="bg-gradient-to-br from-gray-900 to-black rounded-xl p-4 shadow-inner">
                        <% if (media.media_type === 'video') { %>
                            <video 
                                id="mediaPlayer" 
                                class="w-full h-64 bg-black rounded-lg shadow-2xl" 
                                controls 
                                preload="metadata"
                                poster="<%= scanningImageUrl(media.scanning_image) %>"
                            >
                                <source src="<%= mediaUrl(media.file_path) %>" type="<%= media.mime_type %>">
                                Your browser does not support the video tag.
                            </video>
                        <% } else if (media.media_type === 'audio') { %>
                            <div class="bg-gradient-to-br from-gray-800 to-black rounded-lg p-8 text-center shadow-2xl">
                                <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                    <i class="fas fa-music text-white text-2xl"></i>
                                </div>
                                <audio 
                                    id="mediaPlayer" 
                                    class="w-full" 
                                    controls 
                                    preload="metadata"
                                >
                                    <source src="<%= mediaUrl(media.file_path) %>" type="<%= media.mime_type %>">
                                    Your browser does not support the audio tag.
                                </audio>
                            </div>
                        <% } else { %>
                            <div class="relative group">
                                <img 
                                    src="<%= mediaUrl(media.file_path) %>" 
                                    alt="<%= media.title %>" 
                                    class="w-full h-64 object-cover rounded-lg shadow-2xl transition-transform duration-300 group-hover:scale-105"
                                >
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg flex items-center justify-center">
                                    <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <div class="bg-white bg-opacity-90 rounded-full p-3">
                                            <i class="fas fa-expand text-gray-800 text-lg"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Scanning Image Section -->
            <div class="bg-gradient-to-br from-white to-green-50 rounded-xl shadow-lg border border-green-200 overflow-hidden">
                <div class="bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-qrcode text-white text-sm"></i>
                        </div>
                        Scanning Image
                    </h2>
                    <p class="text-green-100 text-sm mt-1">AR scanning target image</p>
                </div>

                <!-- Scanning Image Display -->
                <div class="p-6">
                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl p-6 shadow-inner border border-gray-200">
                        <div class="flex items-center justify-center" style="min-height: 300px;">
                            <div class="relative group">
                                <img 
                                    src="<%= scanningImageUrl(media.scanning_image) %>" 
                                    alt="Scanning Image" 
                                    class="max-w-full max-h-full object-contain rounded-lg shadow-lg border-2 border-dashed border-gray-300 transition-transform duration-300 group-hover:scale-105"
                                    id="scanningImage"
                                >
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300 rounded-lg flex items-center justify-center">
                                    <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                        <div class="bg-white bg-opacity-90 rounded-full p-2">
                                            <i class="fas fa-search text-gray-800 text-sm"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scanning Image Info -->
                    <div class="mt-6 space-y-4">
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-fingerprint text-blue-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Image Hash</h3>
                                        <p class="text-xs text-gray-400">Perceptual hash for similarity detection</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="font-mono text-xs bg-gray-100 px-3 py-1 rounded-lg text-gray-700">
                                        <%= media.image_hash ? media.image_hash.substring(0, 16) + '...' : 'Not available' %>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-shield-alt text-green-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Verification</h3>
                                        <p class="text-xs text-gray-400">Image uniqueness validation</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check mr-1"></i>
                                        Verified
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Media Information Section -->
        <div class="mt-6 space-y-6">
            <!-- Basic Information Card -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-lg border border-blue-100 overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-info-circle mr-3 text-blue-200"></i>
                        Media Information
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Basic Details -->
                        <div class="space-y-6">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-heading text-blue-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Title</h3>
                                    <p class="mt-1 text-lg font-semibold text-gray-900"><%= media.title %></p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-align-left text-green-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Description</h3>
                                    <p class="mt-1 text-sm text-gray-700 leading-relaxed">
                                        <%= media.description || '<span class="text-gray-400 italic">No description provided</span>' %>
                                    </p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-<%= media.media_type === 'video' ? 'video' : media.media_type === 'audio' ? 'music' : 'image' %> text-purple-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Media Type</h3>
                                    <div class="mt-1">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800 capitalize">
                                            <i class="fas fa-<%= media.media_type === 'video' ? 'video' : media.media_type === 'audio' ? 'music' : 'image' %> mr-1"></i>
                                            <%= media.media_type %>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Upload Details -->
                        <div class="space-y-6">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-user text-orange-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Uploaded By</h3>
                                    <p class="mt-1 text-sm font-medium text-gray-900">
                                        <%= media.uploaded_by_name || '<span class="text-gray-400 italic">Unknown</span>' %>
                                    </p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-calendar-plus text-emerald-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Created</h3>
                                    <p class="mt-1 text-sm font-medium text-gray-900">
                                        <%= new Date(media.created_at).toLocaleDateString('en-US', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        }) %>
                                    </p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 bg-cyan-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-cyan-600 text-lg"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Last Updated</h3>
                                    <p class="mt-1 text-sm font-medium text-gray-900">
                                        <%= new Date(media.updated_at).toLocaleDateString('en-US', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        }) %>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Details Card -->
            <div class="bg-gradient-to-br from-gray-50 to-slate-50 rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-gray-700 to-slate-700 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-cogs mr-3 text-gray-300"></i>
                        Technical Details
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- File Size -->
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm border border-gray-100">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-weight text-blue-600 text-lg"></i>
                            </div>
                            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-1">File Size</h3>
                            <p class="text-lg font-bold text-gray-900"><%= (media.file_size / 1024 / 1024).toFixed(2) %> MB</p>
                        </div>

                        <!-- MIME Type -->
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm border border-gray-100">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-file text-green-600 text-lg"></i>
                            </div>
                            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-1">MIME Type</h3>
                            <p class="text-sm font-medium text-gray-900 font-mono"><%= media.mime_type %></p>
                        </div>

                        <!-- Status -->
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm border border-gray-100">
                            <div class="w-12 h-12 bg-<%= media.is_active ? 'green' : 'red' %>-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-<%= media.is_active ? 'check-circle' : 'times-circle' %> text-<%= media.is_active ? 'green' : 'red' %>-600 text-lg"></i>
                            </div>
                            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-1">Status</h3>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium <%= media.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                                <i class="fas fa-<%= media.is_active ? 'check' : 'times' %> mr-1"></i>
                                <%= media.is_active ? 'Active' : 'Inactive' %>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 bg-white rounded-xl shadow-lg border border-gray-200 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Quick Actions</h3>
                    <p class="text-sm text-gray-600 mt-1">Manage your media content</p>
                </div>
                <div class="flex space-x-4">
                    <button 
                        onclick="toggleMediaStatus(<%= media.id %>)" 
                        class="group inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-lg text-white transition-all duration-200 transform hover:scale-105 <%= media.is_active ? 'bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 shadow-lg hover:shadow-xl' : 'bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 shadow-lg hover:shadow-xl' %>"
                    >
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 group-hover:bg-opacity-30 transition-all duration-200">
                            <i class="fas fa-<%= media.is_active ? 'pause' : 'play' %> text-sm"></i>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold"><%= media.is_active ? 'Deactivate' : 'Activate' %></div>
                            <div class="text-xs opacity-90"><%= media.is_active ? 'Make inactive' : 'Make active' %></div>
                        </div>
                    </button>
                    
                    <button 
                        onclick="deleteMedia(<%= media.id %>)" 
                        class="group inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"
                    >
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 group-hover:bg-opacity-30 transition-all duration-200">
                            <i class="fas fa-trash text-sm"></i>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold">Delete Media</div>
                            <div class="text-xs opacity-90">Remove permanently</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // Media player controls
    document.addEventListener('DOMContentLoaded', function() {
        const player = document.getElementById('mediaPlayer');
        if (player) {
            // Add custom controls or event listeners if needed
            player.addEventListener('loadedmetadata', function() {
                console.log('Media loaded:', player.duration);
            });
        }
    });


    // Media management functions (reuse from existing code)
    // editMedia function is defined in admin layout

    function toggleMediaStatus(mediaId) {
        if (confirm('Are you sure you want to change the status of this media?')) {
            fetch(`/admin/media/${mediaId}/toggle`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessToast(data.message);
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    showErrorToast('Error updating media status: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showErrorToast('Error updating media status');
            });
        }
    }

    function deleteMedia(mediaId) {
        if (confirm('Are you sure you want to delete this media? This action cannot be undone.')) {
            fetch(`/admin/media/${mediaId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessToast(data.message);
                    setTimeout(() => {
                        window.location.href = '/admin/media';
                    }, 1000);
                } else {
                    showErrorToast('Error deleting media: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showErrorToast('Error deleting media');
            });
        }
    }
</script>
